<!doctype html>
<html lang="ja">
<head></head>
<body>
<script src="https://apis.google.com/js/client.js"></script>
<script>
const client_id = 'your_client_id';
const scope = ['https://www.googleapis.com/auth/fitness.activity.read'];
let access_token = '';

function getToken() {
    //gapi.auth.authorize({client_id: client_id, scope: scope, immediate: true, response_type: 'token'}, mycallback);
    gapi.auth.authorize({client_id: client_id, scope: scope, immediate: false, response_type: 'token'}, mycallback);
}

function mycallback(e) {
    access_token = e.access_token;
    //alert( 'access_token = ' + access_token );
    console.log(e);
    fetch('https://www.googleapis.com/fitness/v1/users/me/dataSources?access_token=' + access_token)
        .then(response => {
            return response.json();
        })
        .then(json => {
            getSteps( json.dataSource );
        })
}
function getSteps( dataSources ) {
    const start = new Date('2019/3/1 0:00:00').getTime();
    const end = Date.now();
    console.log(new Date(start));
    console.log(new Date(end));

    //fetch('https://www.googleapis.com/fitness/v1/users/me/dataSources/derived:com.google.activity.segment:com.google.android.gms:Google:Pixel 3:********:activity_from_steps/datasets/'+start.toString()+'000000'+'-'+end.toString()+'000000?access_token=' + access_token)
    fetch('https://www.googleapis.com/fitness/v1/users/me/dataSources/' + dataSources[3].dataStreamId + '/datasets/'+start.toString()+'000000'+'-'+end.toString()+'000000?access_token=' + access_token)
        .then(response => {
            return response.json();
        })
        .then(json => {
            console.log(json);
        })
}
window.onload = getToken;
</script>
</body>
</html>
